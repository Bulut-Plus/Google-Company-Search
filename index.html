<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Sitesi Olmayan Firmalar</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify@3.1.11/dist/vuetify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/vuetify@3.1.11/dist/vuetify.min.css" rel="stylesheet">
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB9_hu6yJ7LXoYc0qIWPizJqkubZk6W3f4&libraries=places"></script>
</head>
<body>
  <div id="app">
    <v-app>
      <v-container>
        <h1 class="mb-4">Web Sitesi Olmayan Firmalar</h1>
        <v-form @submit.prevent="search">
          <v-row class="align-center">
            <!-- Arama Yöntemi -->
            <v-col cols="3">
              <v-select
                v-model="searchMethod"
                :items="['Adres ile Ara', 'Lat/Lng ile Ara']"
                label="Arama Yöntemi Seçin"
              ></v-select>
            </v-col>

            <!-- Adres ile Arama -->
            <template v-if="searchMethod === 'Adres ile Ara'">
              <v-col cols="3">
                <v-autocomplete
                  label="İl Seçiniz"
                  v-model="selectedProvince"
                  :items="provinces"
                  item-value="name"
                  item-title="name"
                  @update:model-value="onProvinceChange"
                  required
                ></v-autocomplete>
              </v-col>
              <v-col cols="3">
                <v-autocomplete
                  label="İlçe Seçiniz"
                  v-model="selectedDistrict"
                  :items="districts"
                  item-value="name"
                  item-title="name"
                  required
                ></v-autocomplete>
              </v-col>
            </template>

            <!-- Lat/Lng ile Arama -->
            <template v-if="searchMethod === 'Lat/Lng ile Ara'">
              <v-col cols="3">
                <v-text-field
                  v-model="latitude"
                  label="Enlem (Lat)"
                  placeholder="Örn: 41.0082"
                  required
                ></v-text-field>
              </v-col>
              <v-col cols="3">
                <v-text-field
                  v-model="longitude"
                  label="Boylam (Lng)"
                  placeholder="Örn: 28.9784"
                  required
                ></v-text-field>
              </v-col>
            </template>

            <!-- Arama Motoru Seçimi -->
            <v-col cols="3">
              <v-select
                v-model="searchEngine"
                :items="['LocationIQ', 'Nominatim']"
                label="Arama Motoru Seçin"
                required
              ></v-select>
            </v-col>

            <!-- Kategori -->
            <v-col cols="3">
              <v-text-field
                v-model="category"
                label="Kategori"
                placeholder="Örn: restoran, mobilya, kozmetik"
                required
              ></v-text-field>
            </v-col>

            <!-- Ara Butonu -->
            <v-col cols="3">
              <v-btn color="primary" type="submit">Ara</v-btn>
            </v-col>
          </v-row>
        </v-form>

        <v-divider class="my-4"></v-divider>

        <!-- Sonuçlar -->
        <div v-if="results.length > 0">
          <v-row justify="center" class="mb-4">
            <v-btn color="success" @click="downloadExcel">Excel'e İndir</v-btn>
          </v-row>
          <v-row>
            <v-col cols="12" md="4" v-for="(result, index) in pagedResults[currentPage]" :key="index">
              <v-card>
                <v-card-title>{{ result.name }}</v-card-title>
                <v-card-text>
                  <strong>Adres:</strong> {{ result.address || "Adres bilgisi yok" }} <br>
                  <strong>Puan:</strong> {{ result.rating || "Puanlanmamış" }} <br>
                  <strong>Konum:</strong> {{ result.location.lat }}, {{ result.location.lng }}
                </v-card-text>
              </v-card>
            </v-col>
          </v-row>
        </div>
      </v-container>
    </v-app>
  </div>

  <script>
    const app = Vue.createApp({
      data() {
        return {
          provinces: [],
          districts: [],
          selectedProvince: null,
          selectedDistrict: null,
          category: "",
          latitude: null,
          longitude: null,
          searchMethod: "Adres ile Ara",
          searchEngine: "LocationIQ",
          results: [],
          pagedResults: [],
          currentPage: 0,
          lastLocation: null,
          loading: false,
          pageSize: 100,
        };
      },
      methods: {
        async fetchProvinces() {
          try {
            const response = await fetch("https://turkiyeapi.dev/api/v1/provinces");
            const data = await response.json();
            this.provinces = data.data;
          } catch (error) {
            console.error("İller yüklenirken hata:", error);
          }
        },
        async onProvinceChange() {
          if (!this.selectedProvince) return;
          try {
            const response = await fetch(
              `https://turkiyeapi.dev/api/v1/provinces?name=${this.selectedProvince}`
            );
            const data = await response.json();
            this.districts = data.data[0].districts;
          } catch (error) {
            console.error("İlçeler yüklenirken hata:", error);
          }
        },
        async search() {
          try {
            let location;
            if (this.searchMethod === "Adres ile Ara") {
              if (!this.selectedProvince || !this.selectedDistrict) {
                alert("Lütfen il ve ilçe seçin!");
                return;
              }
              location = await this.getCoordinates(
                `${this.selectedDistrict}, ${this.selectedProvince}`
              );
            } else if (this.searchMethod === "Lat/Lng ile Ara") {
              if (!this.latitude || !this.longitude) {
                alert("Lütfen koordinatları girin!");
                return;
              }
              location = { lat: this.latitude, lng: this.longitude };
            }

            if (!location) {
              alert("Konum bulunamadı!");
              return;
            }

            this.results = [];
            await this.fetchAllResults(location.lat, location.lng, this.category);
          } catch (error) {
            console.error("Arama sırasında hata oluştu:", error);
            alert("Bir hata meydana geldi. Lütfen tekrar deneyin.");
          }
        },
        async getCoordinates(address) {
          const apiUrl =
            this.searchEngine === "LocationIQ"
              ? `https://us1.locationiq.com/v1/search.php?key=YOUR_LOCATIONIQ_KEY&q=${address}&format=json`
              : `https://nominatim.openstreetmap.org/search?format=json&q=${address}`;

          const response = await fetch(apiUrl);
          const data = await response.json();
          if (data.length === 0) return null;
          return {
            lat: parseFloat(data[0].lat),
            lng: parseFloat(data[0].lon),
          };
        },
        async fetchAllResults(lat, lng, keyword) {
          // Your Google Places API or similar logic here
        },
        downloadExcel() {
          const worksheet = XLSX.utils.json_to_sheet(this.results);
          const workbook = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(workbook, worksheet, "Sonuçlar");
          XLSX.writeFile(workbook, "Sonuçlar.xlsx");
        },
      },
      mounted() {
        this.fetchProvinces();
      },
    });

    const vuetify = Vuetify.createVuetify();
    app.use(vuetify);
    app.mount("#app");
  </script>
</body>
</html>
